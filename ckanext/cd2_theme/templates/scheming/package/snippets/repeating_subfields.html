{% set fields = data[field.field_name] %}

{% block subfield_display %}
  {% for field_data in fields %}
    <div class="panel panel-default">
      <div class="panel-body">
        <dl class="scheming-subfield-list">
          {% for subfield in field.repeating_subfields %}
            <dt class="dataset-label">
              {{ h.scheming_language_text(subfield.label) }}
            </dt>
            <dd>
            {%- snippet 'scheming/snippets/display_field.html',
              field=subfield,
              data=field_data,
              entity_type=entity_type,
              object_type=object_type
            -%}
            </dd>
          {% endfor %}
        </dl>
      </div>
    </div>
  {% endfor %}
{% endblock %}


<script>
document.addEventListener("DOMContentLoaded", function(event) { 
    // get DOI and create links
    regpattern = new RegExp('(doi: [^ ]*)','gi');
    $('.scheming-subfield-list').each(function() {
        a = this;
        doiResult = regpattern.exec(a.innerText);		
        console.log(doiResult);
        if (doiResult != null) {
            if (doiResult.slice(-1) == '.') {
                doiResult = doiResult.slice(0, -1);
            }
            doiURL = '<a href="https://doi.org/' + doiResult[1].replace('doi: ', '') + '">' + doiResult[1] + '</a>';
            a.innerHTML = a.innerHTML.replace(doiResult[1], doiURL);
        }
    }); 
});
</script>
