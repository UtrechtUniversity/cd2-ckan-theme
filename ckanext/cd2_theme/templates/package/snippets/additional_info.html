<script>
  url = "/api/3/action/package_relationships_list?id={{pkg_dict.name}}"
    fetch(url)
      .then(res => res.json())
      .then(data => {
        for (const result of data.result) {
          {% if pkg_dict.type == 'wave' %}
          document.getElementsByClassName('heading')[0].innerHTML = '<a class="blank-link" href="/{{pkg_dict.type}}/'+result.object+'">'+result.comment+'</a>';
          {% endif %}
          document.getElementById('relationship').innerHTML = `<th style="width: 20%" scope="row" class="dataset-label">Hierarchy</th><td class="dataset-details">`+ result.type.replace('_',' ') +' '+ '<a href="/{{pkg_dict.type}}/' + result.object + '">'+result.object+'</td>'
        }
      });
  </script>


<section class="additional-info">
  <table class="table table-striped table-condensed">
    <tbody>
    <tr id="relationship"></tr>

    {% if pkg_dict.type == 'dataset' %}
    <tr>
      <th style="width: 20%" scope="row" class="dataset-label">Labels</th>
      <td class="dataset-details">
      <ul class="dataset-resources list-unstyled">
      {% set labels = pkg_dict.dc_labels %}
      {% for label in labels  %}
        {% if label.length != 0 %}
        {% set labelname = label["dc_label"] %}
        <li>
          <a href="{% url_for 'dataset.search', dc_label=labelname %}" class="label label-info">{{label["dc_label"]}}</a>
      </li>
        {% endif %}
      {% endfor %}
      </ul>
      </td>
    </tr>

    <tr>
      <th scope="row" class="dataset-label">Constructs</th>
      <td class="dataset-details">
      <ul class="dataset-resources list-unstyled">
      {% set constructs = pkg_dict.dc_constructs %}
      {% for construct in constructs  %}
      {% if construct.length != 0 %}
      {% set constructname = construct["dc_construct"] %}
        <li>
          <a href="{% url_for 'dataset.search', dc_construct=constructname %}" class="label label-info">{{construct["dc_construct"]}}</a>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
    </td>
    </tr>

    <tr>
      <th scope="row" class="dataset-label">Available measurements:</th>
      <td class="dataset-details">
      <ul class="dataset-resources list-unstyled">

      {% set waves = pkg_dict.wave %}
      {% set waves_passed = [] %}
      {% for wave in waves %}
              {% if wave.wave_cohort not in waves_passed %}
              {% do waves_passed.append(wave.wave_cohort) %}
              {% if waves_passed|length > 1 %}
              <br />
              {% endif %}
              <li>{{ wave.wave_cohort }}</li>&nbsp;
              {% endif %}
              <li data-toggle="tooltip" data-original-title="{{ wave.wave_description }}"><a href="{% url_for 'dataset.search', wave_title=wave.wave_title %}" class="label label-info">{{wave.wave_title}}</a></li>
      {% endfor %}

      </ul>
      </td>
    </tr>
      
      {% elif pkg_dict.type == 'cohort' %}
      <tr>
        <th scope="row" class="dataset-label">Waves:</th>
        <td class="dataset-details">
        <ul class="dataset-resources list-unstyled">
  

        {% for wave in pkg_dict.cohort_waves %}
                <li><a href="wave/{{wave.cohort_wave}}" class="label label-info">{{wave.cohort_wave}}</a></li>
        {% endfor %}
  
        </ul>
        </td>
      </tr>

    
      {% endif %}
      {% block package_additional_info %}
      {% endblock %}
      
    </tbody>
  </table>


  <div class="debug" style="display:none">
    <table class="table table-striped table-condensed">
      {% for key, value in pkg_dict.items() %}
        <tr><td>{{key}}</td><td>{{value}}</td></tr>
      {% endfor %}
     </table>
  </div>
</section>



{% if pkg_dict.type == 'wave' %}
<script>
  document.addEventListener("DOMContentLoaded", function (event) {
    datasetLink = document.getElementsByClassName('fa fa-sitemap')[0].parentElement;
    datasetLink.innerHTML = '<span class="fa fa-folder-open-o"></span> Wave'
  });
</script>
{% elif pkg_dict.type == 'cohort' %}
<script>
  document.addEventListener("DOMContentLoaded", function (event) {
    datasetLink = document.getElementsByClassName('fa fa-sitemap')[0].parentElement;
    datasetLink.innerHTML = '<span class="fa fa-folder-open-o"></span> Cohort'
  });
</script>
{% endif %}